---
description: Skill de generation Pine Script
globs: ["pine/**/*.pine", "docs/pine_*.md"]
---

# Pine Script Generator

## Template Base
```pine
//@version=6
strategy("FT_[ASSET]", overlay=true,
    initial_capital=10000,
    default_qty_type=strategy.percent_of_equity,
    commission_type=strategy.commission.percent,
    commission_value=0.05,
    slippage=2,
    process_orders_on_close=true,
    calc_on_every_tick=false)

// ===============================================================
// PARAMS FROZEN [ASSET] - DO NOT MODIFY
// ===============================================================
float slMult = [SL_VALUE]
float tp1Mult = [TP1_VALUE]
float tp2Mult = [TP2_VALUE]
float tp3Mult = [TP3_VALUE]
int tenkanPeriod = [TENKAN]
int kijunPeriod = [KIJUN]
int tenkan5Period = [TENKAN5]
int kijun5Period = [KIJUN5]
int displacement = [DISP]
float trailStart = 9.0
float trailStep = 7.0
int warmupBars = 200

// ===============================================================
// ATR & LEVELS
// ===============================================================
atr14 = ta.atr(14)
entryPrice = strategy.position_avg_price
slLevel = entryPrice - (atr14 * slMult)
tp1Level = entryPrice + (atr14 * tp1Mult)
tp2Level = entryPrice + (atr14 * tp2Mult)
tp3Level = entryPrice + (atr14 * tp3Mult)

// ===============================================================
// ICHIMOKU STANDARD
// ===============================================================
tenkan = (ta.highest(high, tenkanPeriod) + ta.lowest(low, tenkanPeriod)) / 2
kijun = (ta.highest(high, kijunPeriod) + ta.lowest(low, kijunPeriod)) / 2
senkouA = (tenkan + kijun) / 2
senkouB = (ta.highest(high, 52) + ta.lowest(low, 52)) / 2

// ===============================================================
// ICHIMOKU 5-IN-1
// ===============================================================
tenkan5 = (ta.highest(high, tenkan5Period) + ta.lowest(low, tenkan5Period)) / 2
kijun5 = (ta.highest(high, kijun5Period) + ta.lowest(low, kijun5Period)) / 2

// ===============================================================
// SIGNAL LOGIC (ANTI LOOK-AHEAD: use [1] shift)
// ===============================================================
puzzleLong = ta.crossover(tenkan[1], kijun[1]) and close > senkouA[displacement]
fiveInOneLong = tenkan5[1] > kijun5[1]
finalSignal = puzzleLong and fiveInOneLong and bar_index > warmupBars

// ===============================================================
// ENTRIES & EXITS
// ===============================================================
if finalSignal and strategy.position_size == 0
    strategy.entry("Long", strategy.long)

// Multi-TP: 50% / 30% / 20%
strategy.exit("TP1", "Long", qty_percent=50, limit=tp1Level, stop=slLevel)
strategy.exit("TP2", "Long", qty_percent=60, limit=tp2Level, stop=entryPrice)  // BE after TP1
strategy.exit("TP3", "Long", qty_percent=100, limit=tp3Level, stop=tp1Level)

// ===============================================================
// ALERTS (Telegram-ready JSON)
// ===============================================================
alertcondition(finalSignal, "FT_[ASSET]_ENTRY", 
    '{"asset":"[ASSET]","action":"LONG_ENTRY","price":{{close}},"sl":{{plot_0}},"tp1":{{plot_1}}}')
```

## Params par Asset (a remplir)
| Asset | sl | tp1 | tp2 | tp3 | tenkan | kijun | tenkan5 | kijun5 | disp |
|-------|-----|-----|-----|-----|--------|-------|---------|--------|------|
| BTC | 3.75 | 3.75 | 9.0 | 7.0 | 13 | 34 | 12 | 21 | 52 |
| ETH | 4.50 | 4.75 | 3.0 | 4.5 | 17 | 31 | 13 | 20 | 52 |
| ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |

## Validation Checklist
- [ ] `[1]` shift sur TOUS les signaux (anti look-ahead)
- [ ] Commission 0.05% (5 bps)
- [ ] Slippage 2 ticks
- [ ] process_orders_on_close = true
- [ ] warmupBars = 200
- [ ] Multi-TP: 50/30/20 split
