---
description: Master Plan FINAL TRIGGER v2 Multi-Agent System
globs: ["**/*"]
alwaysApply: true
---

# MASTER PLAN â€” FINAL TRIGGER v2

> **Source de vÃ©ritÃ© pour les RÃˆGLES et PARAMÃˆTRES.**
> Pour l'Ã©tat du projet â†’ `status/project-state.md`
> Pour les commandes â†’ `docs/WORKFLOW_PIPELINE.md`

---

## âš ï¸ RÃˆGLES DE MISE Ã€ JOUR

**CE FICHIER EST STABLE** â€” Modifier uniquement si:
- Changement de seuil validÃ© par tests scientifiques
- Nouveau guard ajoutÃ©/retirÃ© (avec PR approuvÃ©e)
- Correction d'erreur documentÃ©e

**NE PAS MODIFIER:**
- Tableau PARAMÃˆTRES sans validation scientifique
- Seuils guards sans PR approuvÃ©e
- Anti-patterns (rÃ¨gles fixes)

**OWNER:** Alex (Lead Quant) â€” Approbation requise pour tout changement

---

## ğŸ“Š PARAMÃˆTRES PIPELINE (Source Unique)

| Phase | Nom | Workers | Trials | Guards | Seuils |
|:-----:|-----|:-------:|:------:|:------:|--------|
| **1** | Screening | **10** | 200 | OFF | WFE>0.5, Sharpe>0.5, Trades>50, **SHORT 25-75%** |
| **2** | Validation | **1** | 300 | ON (11) | WFE>0.6, Sharpe>1.0, Trades>60 |
| **3** | Rescue | **1** | 300 | ON (11) | 7/7 hard PASS |
| **4** | Signal Parity | - | - | - | 100% Python/Pine match |
| **5** | Portfolio | - | - | - | CorrÃ©lations <0.5 |
| **6** | Production | - | - | - | ReproductibilitÃ© 2 runs |

### Displacements Valides

| Displacement | Usage |
|:------------:|-------|
| d26 | Meme/fast (DOGE, SHIB, JOE) |
| d52 | Standard (BTC, ETH, majeurs) |
| d78 | L2/slow (OP, ARB) |

### Filter Modes

| Mode | Filtres | Trades min | WFE min |
|------|:-------:|:----------:|:-------:|
| baseline | 1 | 60 | 0.6 |
| moderate | 5 | 50 | 0.6 |
| conservative | 7 | 40 | 0.55 |

---

## ğŸ›¡ï¸ 11 GUARDS

### 7 Hard Guards (MUST PASS)

| # | Guard | Seuil |
|:-:|-------|-------|
| 1 | WFE Pardo | >0.6 |
| 2 | Sensitivity | <15% |
| 3 | Bootstrap CI | >1.0 |
| 4 | Monte Carlo | p<0.05 |
| 5 | Top10 Concentration | <40% |
| 6 | Trades OOS | â‰¥60 |
| 7 | Bars IS | â‰¥8000 |

### 4 Soft Guards (Report + Rescue if FAIL)

| # | Guard | Seuil |
|:-:|-------|-------|
| 8 | PBO | <0.50 |
| 9 | DSR | >85% |
| 10 | CPCV | >0.8 all folds |
| 11 | PSR | >95% |

---

## â›” ANTI-PATTERNS (JAMAIS)

### 1. Look-Ahead Bias
```python
signal = indicator.shift(1)  # âœ… TOUJOURS
signal = indicator           # âŒ INTERDIT
```

### 2. TP Non-Progressif
```python
assert tp1 < tp2 < tp3
assert (tp2 - tp1) >= 0.5 and (tp3 - tp2) >= 0.5
```

### 3. Regime sur Exit Time
```python
regime = get_regime_at(entry_time)  # âœ… CORRECT
regime = get_regime_at(exit_time)   # âŒ INTERDIT
```

### 4. RÃ©sultats Suspects â†’ CHALLENGER
- Sharpe > 4.0 â†’ Reconciliation obligatoire
- WFE > 2.0 â†’ VÃ©rifier overfitting

### 5. Workers Phase 2+
```bash
--workers 1  # âœ… OBLIGATOIRE Phase 2+
```

---

## ğŸŒ³ ARBRES DE DÃ‰CISION

### Choix Displacement
```
Asset type?
â”œâ”€â”€ Meme/Fast (DOGE, SHIB, JOE) â†’ d26
â”œâ”€â”€ Standard (BTC, ETH, majeurs) â†’ d52
â””â”€â”€ L2/Slow (OP, ARB) â†’ d78
```

### Si Guard FAIL
```
Quel guard?
â”œâ”€â”€ WFE < 0.6 â†’ Autre displacement
â”œâ”€â”€ Sensitivity > 15% â†’ Filter cascade
â”œâ”€â”€ Trades < 60 â†’ Plus de donnÃ©es
â”œâ”€â”€ SIDEWAYS Sharpe < 0 â†’ EXCLU dÃ©finitif
â””â”€â”€ Autre â†’ BLOCKED
```

### Filter Rescue
```
baseline FAIL â†’ moderate â†’ conservative â†’ EXCLU
```

---

## ğŸ¤– AGENTS

| Agent | RÃ´le | DÃ©cide |
|-------|------|--------|
| **Casey** | Orchestrateur | PrioritÃ©s, verdicts |
| **Jordan** | Developer | Fixes techniques |
| **Sam** | QA | Guards PASS/FAIL |
| **Alex** | Lead Quant | Architecture, recherche |

### Fichiers Agents
| Fichier | Owner |
|---------|-------|
| `comms/casey-quant.md` | Casey |
| `comms/jordan-dev.md` | Jordan |
| `comms/sam-qa.md` | Sam |
| `comms/alex-lead.md` | Alex |

---

## ğŸ“ FICHIERS RÃ‰FÃ‰RENCE

| Fichier | Contenu |
|---------|--------|
| `status/project-state.md` | Ã‰tat actuel (assets, progression) |
| `docs/WORKFLOW_PIPELINE.md` | Commandes par phase |
| `.cursor/rules/MASTER_PLAN.mdc` | **CE FICHIER** (rÃ¨gles, params) |

### OBSOLÃˆTES (ne pas utiliser)
- âŒ `docs/HANDOFF.md`
- âŒ `docs/WORKFLOW_MULTI_ASSET_SCREEN_VALIDATE_PROD.md`

---

## ğŸ¯ CONTRAINTES LIVE

| MÃ©trique | Backtest â†’ Live |
|----------|-----------------|
| Sharpe | Ã—0.5-0.7 |
| MaxDD | Ã—2-3 |

---

**Version**: 2.1 (26 Jan 2026)
**DerniÃ¨re MAJ**: Ajout rÃ¨gles MAJ + SHORT ratio
