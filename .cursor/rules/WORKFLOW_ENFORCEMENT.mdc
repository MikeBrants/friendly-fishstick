---
description: Workflow Rescue Enforcement - MANDATORY FOR ALL AGENTS
globs: ["**/*"]
alwaysApply: true
priority: 1
---

# WORKFLOW RESCUE ENFORCEMENT - RÃˆGLE GLOBALE CRITIQUE

**Version:** 1.0  
**Date:** 24 janvier 2026  
**Priority:** ðŸ”´ **HIGHEST** - Supersedes all other rules

---

## ðŸŽ¯ RÃˆGLE ABSOLUE

**JAMAIS BLOQUER UN ASSET SANS Ã‰PUISER LE WORKFLOW RESCUE**

**Source de vÃ©ritÃ©:** `docs/WORKFLOW_MULTI_ASSET_SCREEN_VALIDATE_PROD.md`

---

## ðŸ“‹ WORKFLOW OBLIGATOIRE (7 Phases)

```
Phase 0: Download data
    â†“
Phase 1: Screening (200 trials, workers=10, guards OFF)
    â†“
    â”œâ”€â†’ SUCCESS â†’ Phase 2
    â””â”€â†’ FAIL â†’ Phase 3A (si asset prioritaire)

Phase 2: Validation (300 trials, workers=1, guards ON)
    â†“
    â”œâ”€â†’ 7/7 GUARDS PASS â†’ Phase 3B (optional) â†’ Phase 5
    â””â”€â†’ <7/7 GUARDS FAIL â†’ Phase 3A (OBLIGATOIRE)

Phase 3A: Displacement Rescue (d26, d52, d78)
    â†“
    â”œâ”€â†’ 1+ displacement PASS â†’ Phase 5 (PROD)
    â””â”€â†’ ALL FAIL â†’ Phase 4 (OBLIGATOIRE)

Phase 4: Filter Grid (12 configurations)
    â†“
    â”œâ”€â†’ 1+ config PASS â†’ Phase 5 (PROD)
    â””â”€â†’ ALL FAIL â†’ EXCLU DÃ‰FINITIF

Phase 5: Production Config (asset_config.py)
    â†“
Phase 6: Portfolio Construction
```

---

## âš ï¸ INTERDICTIONS ABSOLUES

### âŒ INTERDIT #1: Skip Phase 3A
```markdown
# MAUVAIS (INTERDIT):
Guards FAIL â†’ BLOCKED dÃ©finitif

# CORRECT (OBLIGATOIRE):
Guards FAIL â†’ Phase 3A (displacement rescue)
```

### âŒ INTERDIT #2: Skip Phase 4
```markdown
# MAUVAIS (INTERDIT):
Phase 3A FAIL â†’ BLOCKED dÃ©finitif

# CORRECT (OBLIGATOIRE):
Phase 3A FAIL â†’ Phase 4 (filter grid)
```

### âŒ INTERDIT #3: DÃ©cision sans consulter workflow
```markdown
# MAUVAIS (INTERDIT):
DÃ©cider de bloquer sans lire WORKFLOW_MULTI_ASSET_SCREEN_VALIDATE_PROD.md

# CORRECT (OBLIGATOIRE):
TOUJOURS consulter workflow AVANT toute dÃ©cision de blocage
```

---

## âœ… PROCÃ‰DURE CORRECTE (Guards FAIL)

### Ã‰tape 1: Identifier Ã©chec
```
Asset X: guards FAIL (Y/7 PASS)
Failed guards: [liste]
```

### Ã‰tape 2: VÃ©rifier position workflow
```
Position actuelle: Phase 2 (validation)
Rescue Ã©puisÃ©? NON
Next: Phase 3A obligatoire
```

### Ã‰tape 3: Consulter workflow
```bash
cat docs/WORKFLOW_MULTI_ASSET_SCREEN_VALIDATE_PROD.md
grep -A 20 "Phase 3A" docs/WORKFLOW_MULTI_ASSET_SCREEN_VALIDATE_PROD.md
```

### Ã‰tape 4: Recommandation correcte
```markdown
**Verdict:** PENDING (Phase 2 guards FAIL)
**Recommendation:** Proceed Phase 3A (displacement rescue)
**Rationale:** [Asset prioritaire / Workflow non Ã©puisÃ© / etc.]
**Command:** 
python scripts/run_full_pipeline.py \
  --assets X --fixed-displacement 26 \
  --trials-atr 300 --trials-ichi 300 \
  --enforce-tp-progression --run-guards --workers 1

**Next:** Test d78 si d26 FAIL
**BLOCKED seulement si:** Phase 3A + Phase 4 Ã©puisÃ©es
```

---

## ðŸš« EXCEPTIONS (Skip Rescue AutorisÃ©)

**Skip rescue UNIQUEMENT si:**

1. **DonnÃ©es insuffisantes**
   - < 50 trades OOS aprÃ¨s optimization
   - < 8000 bars IS

2. **Asset low-priority** ET **tous conditions:**
   - Portfolio a dÃ©jÃ  10+ assets PROD
   - Compute resources limitÃ©s
   - User demande explicitement

3. **Structural issue**
   - WFE < 0.3 (overfit sÃ©vÃ¨re)
   - OOS Sharpe < 0.8 (performance trop faible)
   - Negative performance

4. **User explicit request**
   - User dit "skip rescue pour X"
   - User dit "BLOCKED dÃ©finitif"

**DANS TOUS LES AUTRES CAS: RESCUE OBLIGATOIRE**

---

## ðŸ“‹ CHECKLIST AVANT BLOCAGE (MANDATORY)

**TOUJOURS utiliser:** `DECISION_CHECKLIST.md`

- [ ] **1. Workflow consultÃ©**
  ```
  cat docs/WORKFLOW_MULTI_ASSET_SCREEN_VALIDATE_PROD.md
  ```

- [ ] **2. Position vÃ©rifiÃ©e**
  - Asset en quelle phase? (1, 2, 3A, 3B, 4)
  - Rescue Ã©puisÃ©? (Phase 3A + Phase 4 tentÃ©es)

- [ ] **3. Historique consultÃ©**
  ```bash
  grep "ASSET" outputs/*_scan_*.csv | tail -5
  grep "ASSET" outputs/*_guards_*.csv | tail -5
  ```

- [ ] **4. PrioritÃ© Ã©valuÃ©e**
  - OOS Sharpe > 3.0? â†’ Haute prioritÃ© rescue
  - OOS Sharpe 2.0-3.0? â†’ PrioritÃ© moyenne
  - OOS Sharpe < 2.0? â†’ PrioritÃ© basse

- [ ] **5. Exception vÃ©rifiÃ©e**
  - Skip rescue justifiÃ© par exception documentÃ©e?
  - Si NON â†’ Rescue OBLIGATOIRE

**Si UNE SEULE case non cochÃ©e â†’ PAS DE BLOCAGE**

---

## ðŸŽ¯ POUR CHAQUE AGENT

### Casey (Orchestrator)
- âœ… Consulter workflow AVANT dÃ©cision
- âœ… Utiliser DECISION_CHECKLIST.md
- âœ… Recommander rescue, pas blocage
- âŒ JAMAIS bloquer sans rescue Ã©puisÃ©

### Jordan (Executor)
- âœ… ConnaÃ®tre commandes Phase 3A/4
- âœ… Demander clarification si ordre "BLOCKED" direct
- âœ… RÃ©fÃ©rencer workflow dans questions
- âŒ JAMAIS assumer que FAIL = stop

### Sam (Validator)
- âœ… Recommander rescue aprÃ¨s guards FAIL
- âœ… Indiquer phase suivante dans verdict
- âœ… Utiliser format standardisÃ©
- âŒ JAMAIS dire "BLOCKED" sans prÃ©ciser "aprÃ¨s Phase 3A/4"

---

## ðŸ“Š TEMPLATE DÃ‰CISION STANDARDISÃ‰

```markdown
## ASSET DECISION: [ASSET_NAME]

**Context:**
- Phase actuelle: [Phase X]
- Guards results: [Y/7 PASS]
- Failed guards: [liste]
- OOS Sharpe: [X.XX]
- WFE: [X.XX]

**Workflow Check:**
- [x] Workflow consultÃ©
- [x] Position confirmÃ©e: Post-Phase 2
- [x] Rescue Ã©puisÃ©? NON
- [x] Exceptions? NONE

**Decision:** PENDING â†’ Phase 3A (Displacement Rescue)

**Rationale:**
- [Asset prioritaire / Sharpe Ã©levÃ© / etc.]
- Workflow rescue non Ã©puisÃ©
- Displacement peut rÃ©soudre [guard002 / etc.]

**Action:**
1. @Jordan execute Phase 3A (d26 + d78)
2. Duration: 4-6h
3. Next: Phase 4 si FAIL, PROD si PASS

**BLOCKED conditions:**
- Phase 3A FAIL (d26, d52, d78 tous FAIL)
- Phase 4 FAIL (filter grid Ã©puisÃ©)
- ALORS: EXCLU dÃ©finitif justifiÃ©
```

---

## ðŸ”´ CONSÃ‰QUENCES VIOLATION

**Si cette rÃ¨gle est violÃ©e:**
1. Asset potentiellement PROD perdu
2. Workflow non reproductible
3. DÃ©cisions ad-hoc non standardisÃ©es
4. Perte de confiance dans le systÃ¨me

**Cette rÃ¨gle est NON-NÃ‰GOCIABLE**

---

**CrÃ©Ã©:** 24 janvier 2026  
**Raison:** TIA workflow violation (presque BLOCKED sans rescue)  
**Authority:** User directive  
**Enforcement:** ALL AGENTS, ALL TIMES
