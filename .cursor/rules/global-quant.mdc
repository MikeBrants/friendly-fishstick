***
description: R√®gles quant obligatoires FINAL TRIGGER v2 (2026-01-22)
globs: ["**/*.py", "**/*.md", "outputs/**/*"]
alwaysApply: true
***

# Protocole Quant Multi-Agent ‚Äî FINAL TRIGGER v2

## ‚ö†Ô∏è ALERTE CRITIQUE
**Tous les r√©sultats datant d'AVANT 2026-01-22 12H00 sont INVALIDES.**
Le bug TP progression est maintenant fix√© (`--enforce-tp-progression`).

***

## ‚úÖ ASSETS VALID√âS (Production-Ready)

| Asset | Mode | Disp | OOS Sharpe | WFE | Trades | Status |
|:------|:-----|:-----|:-----------|:----|:-------|:-------|
| BTC | baseline | 52 | 2.14 | >0.6 | 416 | ‚úÖ PROD |
| ETH | medium_distance_volume | 52 | 2.09 | 0.82 | 57 | ‚úÖ PROD |
| JOE | baseline | 26 | 5.03 | 1.44 | 63 | ‚úÖ PROD |
| OSMO | baseline | 65 | 3.18 | 0.77 | 57 | ‚úÖ PROD |
| MINA | baseline | 78 | 1.76 | 0.61 | 78 | ‚úÖ PROD |

***

## ASSETS EXCLUS (Definitif)

SEI, CAKE, AXS, RUNE, TON, SOL, AAVE, HYPE, ATOM, ARB, LINK, INJ, TIA,
HOOK, ALICE, HMSTR, LOOM, APT, EIGEN, ONDO, ICP, ARKM, YGG, CELO

***

## üî¥ 7 GUARDS OBLIGATOIRES

| Guard | ID | Seuil | Critique |
|:------|:---|:------|:---------|
| MC p-value | guard001 | <0.05 | OUI |
| Sensitivity variance | guard002 | <10% | OUI |
| Bootstrap CI lower | guard003 | >1.0 | OUI |
| Top10 trades % | guard005 | <40% | OUI |
| Stress1 Sharpe | guard006 | >1.0 | OUI |
| Regime mismatch | guard007 | <1% | OUI |
| WFE | - | >0.6 | OUI |

**Seuils additionnels:**
- OOS Sharpe >1.0 (target >2.0)
- OOS Trades >60
- TP Progression: TP1 < TP2 < TP3, gap ‚â•0.5

**GATE : 7/7 PASS obligatoire avant tout merge.**

***

## üî¥ ANTI-PATTERNS CRITIQUES

### 1. Look-Ahead
```python
signal = indicator.shift(1)  # ‚úÖ TOUJOURS
signal = indicator           # ‚ùå INTERDIT
```

### 2. TP Progression
```python
assert tp1 < tp2 < tp3, "TP must be progressive"
assert (tp2 - tp1) >= 0.5 and (tp3 - tp2) >= 0.5, "Gap minimum 0.5"
```

### 3. Regime Attribution
```python
regime = get_regime_at(entry_time)  # ‚úÖ CORRECT
regime = get_regime_at(exit_time)   # ‚ùå INTERDIT
```

### 4. SIDEWAYS
**NE PAS filtrer le r√©gime SIDEWAYS** ‚Äî c'est 79.5% du profit.

### 5. R√©sultats suspects
**CHALLENGER** si Sharpe >4 ou WFE >2 ‚Üí demander r√©conciliation.

***

## üìä FILTER MODES

| Mode | Usage |
|:-----|:------|
| baseline | Default, premier test |
| medium_distance_volume | **WINNER ETH** ‚≠ê |
| light_kama / light_distance / light_volume | L√©gers |
| moderate / conservative | Dernier recours |

***

## üìä DISPLACEMENT VARIANTS

| Type | Valeur | Assets |
|:-----|:-------|:-------|
| Fast (meme) | 26 | JOE, DOGE |
| Standard | 52 | BTC, ETH |
| Slow | 65-78 | OSMO, MINA, OP |

***

## üîß COMMANDES PIPELINE

### Baseline avec TP enforced
```bash
python scripts/run_full_pipeline.py \
  --assets <ASSET_LIST> \
  --workers 6 \
  --trials-atr 150 \
  --trials-ichi 150 \
  --enforce-tp-progression \
  --skip-download \
  --run-guards
```

### Avec filter mode
```bash
--optimization-mode medium_distance_volume
```

### Avec displacement fix√©
```bash
--fixed-displacement 78
```

***

## üìÅ FICHIERS R√âF√âRENCE

| Fichier | Description |
|:--------|:------------|
| docs/HANDOFF.md | R√©sum√© ex√©cutif |
| docs/BACKTESTING.md | R√©sultats d√©taill√©s |
| docs/WORKFLOW_MULTI_ASSET_SCREEN_VALIDATE_PROD.md | Workflow 3 phases |
| outputs/multiasset_scan_*.csv | R√©sultats scans |
| outputs/multiasset_guards_summary_*.csv | R√©sultats guards |
