---
description: Workflow Pipeline 6 Phases
globs: ["scripts/**", "outputs/**"]
alwaysApply: true
---

# Pipeline FINAL TRIGGER v2 (6 Phases)

| Phase | Nom | Criteres/Output |
|-------|-----|-----------------|
| 0 | Download | `data/*.parquet` |
| 1 | Screening | 200 trials, guards OFF, WFE>0.5, Sharpe>0.8, Trades>50 |
| 2 | Validation | 300 trials, 7 guards ON -> WINNERS + PENDING |
| 3A | Rescue | PENDING: d26/d52/d78, 7/7 PASS -> WINNERS |
| 3B | Optimization | WINNERS: d26/d52/d78, +10% ET 7/7 PASS -> remplace |
| 4 | Filter Grid | PENDING: 12 combinaisons filtres |
| 5 | Production | `asset_config.py` + `project-state.md` |

## Critere remplacement Phase 3B
```python
if new_sharpe > old_sharpe * 1.10 and all_guards_pass:
    use_new_displacement = True
```

## Filter Modes (Phase 4) - 12 modes

| Mode | Filtres actifs |
|------|----------------|
| baseline | ichimoku only |
| light_kama | ichimoku + kama_oscillator |
| light_distance | ichimoku + distance_filter |
| light_volume | ichimoku + volume_filter |
| light_regression | ichimoku + regression_cloud |
| medium_kama_distance | ichimoku + kama + distance |
| medium_kama_volume | ichimoku + kama + volume |
| medium_kama_regression | ichimoku + kama + regression |
| medium_distance_volume | ichimoku + distance + volume (WINNER ETH) |
| moderate | 5 filtres (tous sauf strict) |
| strict_ichi | ichimoku strict (17 cond) |
| conservative | 6 filtres + strict (dernier recours) |

## Commandes par Phase
```bash
# Phase 1: Screening (workers=6 OK)
python scripts/run_full_pipeline.py --assets ALL --workers 6 \
    --trials-atr 150 --trials-ichi 150 --skip-guards

# Phase 2: Validation (workers=1 OBLIGATOIRE pour reproductibilit√©)
python scripts/run_full_pipeline.py --assets WINNERS --workers 1 \
    --trials-atr 300 --trials-ichi 300 --enforce-tp-progression --run-guards

# Phase 3A: Rescue (displacement grid)
python scripts/run_displacement_grid.py --assets PENDING

# Phase 3B: Optimization
python scripts/run_phase3b_optimization.py --assets WINNERS --workers 1

# Phase 4: Filter Grid
python scripts/run_filter_grid.py --assets PENDING --workers 1
```
